(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&e(d)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}})();const h=document.getElementById("gridCanvas");if(!h)throw new Error("Canvas element with id 'gridCanvas' not found.");const x=h.getContext("2d");if(!x)throw new Error("Failed to get 2D context from canvas.");const c=100;let s=1;const W=.5,_=2;let p=0,w=0,m=!1,X=0,k=0,b=!1,R=0,$={x:0,y:0};const S=new Map;function E(){x.clearRect(0,0,h.width,h.height),x.save(),x.scale(s,s);const o=h.width/s,t=h.height/s,i=Math.ceil(o/c)+1,e=Math.ceil(t/c)+1,r=Math.floor(p/c)*c,n=Math.floor(w/c)*c,d=1/s;x.lineWidth=d,x.font="12px sans-serif",x.fillStyle="#aaf";for(let l=0;l<i;l++){const u=r+l*c-p;for(let a=0;a<e;a++){const y=n+a*c-w;x.strokeStyle="#444",x.strokeRect(u,y,c,c);const v=Math.floor((r+l*c)/c),f=Math.floor((n+a*c)/c);x.fillText(`${v},${f}`,u+5,y+15)}}for(const l of S.values()){const u=(l.gridX*c-p)*s,a=(l.gridY*c-w)*s;l.domCanvas.style.transform=`translate(${u}px, ${a}px)`,l.domCanvas.style.width=`${l.wCells*c*s}px`,l.domCanvas.style.height=`${l.hCells*c*s}px`}x.restore()}function z(){h.width=window.innerWidth,h.height=window.innerHeight,E()}window.addEventListener("resize",z);z();const D=new Map;function M(o,t,i,e,r){const n=`${o}_${i}_${t}_${e}`,d=c*i,l=c*e,u=new Worker(r,{type:"module"}),a=document.createElement("canvas");a.width=d,a.height=l,a.style.position="absolute",a.style.pointerEvents="none",a.style.zIndex="1",document.body.appendChild(a);const y=a.transferControlToOffscreen();y.width=d,y.height=l,u.onmessage=f=>{if(f.data.type==="intercept"){const{eventId:Y,intercepted:L}=f.data,g=D.get(Y);g&&(g(L),D.delete(Y))}else if(f.data.type==="message"){const Y={n:[0,-1],ne:[1,-1],e:[1,0],se:[1,1],s:[0,1],sw:[-1,1],w:[-1,0],nw:[-1,-1]},L=f.data.to===void 0?Object.keys(Y):Array.isArray(f.data.to)?f.data.to:[f.data.to],g=f.data.from===void 0?[0,0]:f.data.from;if(g[0]<0||g[0]>=i||g[1]<0||g[1]>=e)return;for(const A of L){const I=Y[A];if(!I)continue;const B=o+g[0]+I[0],H=t+g[1]+I[1];for(const[,C]of S)for(let T=0;T<C.wCells;T++)for(let P=0;P<C.hCells;P++)C.gridX+T===B&&C.gridY+P===H&&C.worker.postMessage({type:"message",payload:f.data.payload})}}},u.postMessage({type:"init",width:d,height:l,wCells:i,hCells:e,offCanvas:y},[y]);const v={gridX:o,gridY:t,wCells:i,hCells:e,worker:u,canvas:y,domCanvas:a,requestEventId:(()=>{let f=0;return()=>f++})()};S.set(n,v)}M(4,2,1,2,"/workers/worker1.js");M(3,3,1,1,"/workers/worker2.js");M(2,4,2,1,"/workers/worker1.js");M(2,3,1,1,"/workers/worker3.js");M(3,2,1,1,"/workers/worker4.js");M(2,2,1,1,"/workers/worker5.js");M(2,1,1,1,"/workers/worker6.js");E();h.addEventListener("mousedown",async o=>{const t=o.offsetX/s+p,i=o.offsetY/s+w;for(const e of S.values()){const r=e.gridX*c,n=e.gridY*c,d=e.wCells*c,l=e.hCells*c,u=t-r,a=i-n;if(u>=0&&u<=d&&a>=0&&a<=l){const y=e.requestEventId(),v=new Promise(Y=>{const L=setTimeout(()=>{D.delete(y),Y(!1)},50);D.set(y,g=>{clearTimeout(L),Y(g)})});if(e.worker.postMessage({type:"click",x:u,y:a,eventId:y}),await v)return}}m=!0,X=o.clientX,k=o.clientY});h.addEventListener("mousemove",o=>{m&&(p-=(o.clientX-X)/s,w-=(o.clientY-k)/s,X=o.clientX,k=o.clientY,E())});h.addEventListener("mouseup",()=>m=!1);h.addEventListener("mouseleave",()=>m=!1);h.addEventListener("wheel",o=>{o.preventDefault();const t=1.1,i=o.offsetX/s+p,e=o.offsetY/s+w;s=o.deltaY<0?Math.min(_,s*t):Math.max(W,s/t),p=i-o.offsetX/s,w=e-o.offsetY/s,E()},{passive:!1});const q=5;let j=0,O=0;h.addEventListener("touchstart",o=>{o.preventDefault();const t=o.touches;if(t.length===1)b=!1,m=!1,j=t[0].clientX,O=t[0].clientY,X=j,k=O;else if(t.length===2){b=!0,m=!1;const i={x:t[0].clientX,y:t[0].clientY},e={x:t[1].clientX,y:t[1].clientY};R=Math.hypot(e.x-i.x,e.y-i.y),$={x:(i.x+e.x)/2,y:(i.y+e.y)/2}}},{passive:!1});h.addEventListener("touchmove",o=>{o.preventDefault();const t=o.touches;if(t.length===1&&!b){const i=t[0].clientX-j,e=t[0].clientY-O;if(!m&&Math.hypot(i,e)>q&&(m=!0),m){const r=(t[0].clientX-X)/s,n=(t[0].clientY-k)/s;p-=r,w-=n,X=t[0].clientX,k=t[0].clientY,E()}}else if(t.length===2){const i={x:t[0].clientX,y:t[0].clientY},e={x:t[1].clientX,y:t[1].clientY},r=Math.hypot(e.x-i.x,e.y-i.y),n={x:(i.x+e.x)/2,y:(i.y+e.y)/2},d=r/R,l=n.x/s+p,u=n.y/s+w;s=Math.min(_,Math.max(W,s*d)),p=l-n.x/s,w=u-n.y/s;const a=(n.x-$.x)/s,y=(n.y-$.y)/s;p-=a,w-=y,R=r,$=n,E()}},{passive:!1});h.addEventListener("touchend",o=>{o.preventDefault();const t=o.touches;if(!b&&!m&&t.length===0){const i=j-h.getBoundingClientRect().left,e=O-h.getBoundingClientRect().top,r=i/s+p,n=e/s+w;for(const d of S.values()){const l=d.gridX*c,u=d.gridY*c,a=d.wCells*c,y=d.hCells*c,v=r-l,f=n-u;if(v>=0&&v<=a&&f>=0&&f<=y){d.worker.postMessage({type:"click",x:v,y:f});break}}}t.length===1?(b=!1,m=!0,X=t[0].clientX,k=t[0].clientY):t.length===0&&(b=!1,m=!1)},{passive:!1});
